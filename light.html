<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ® 2026 éˆä¸Šå…‰æ˜ç‡ˆ | V9</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@700&family=Roboto+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-gold: #FFD700;
            --primary-red: #D90429;
            --dark-bg: #1a0505;
            --card-bg: rgba(60, 10, 10, 0.95);
            --neon-glow: 0 0 15px var(--primary-gold), 0 0 30px var(--primary-red);
        }
        body {
            background-color: var(--dark-bg);
            background-image: radial-gradient(circle at 50% 30%, #4a0000 0%, #1a0505 70%);
            color: var(--primary-gold);
            font-family: 'Noto Serif TC', 'Microsoft JhengHei', serif;
            text-align: center;
            margin: 0; padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* èªè¨€åˆ‡æ›å€ */
        .lang-bar {
            background: rgba(0,0,0,0.8);
            padding: 10px;
            display: flex;
            justify-content: center;
            gap: 15px;
            position: sticky;
            top: 0;
            z-index: 200;
            border-bottom: 1px solid #550000;
        }
        .lang-btn {
            background: transparent;
            border: 1px solid var(--primary-gold);
            color: var(--primary-gold);
            padding: 5px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .lang-btn.active, .lang-btn:hover {
            background: var(--primary-gold);
            color: #300;
            font-weight: bold;
        }

        .marquee-container {
            background: rgba(0, 0, 0, 0.9);
            border-bottom: 1px solid var(--primary-gold);
            width: 100%; height: 40px;
            display: flex; align-items: center;
            overflow: hidden; position: relative; z-index: 100;
        }
        .marquee-content {
            display: inline-block; white-space: nowrap;
            animation: scroll 80s linear infinite;
            color: #fff; font-size: 15px;
        }
        .marquee-item { margin-right: 50px; display: inline-flex; align-items: center; }
        .marquee-addr { color: var(--primary-gold); margin-right: 8px; font-family: monospace; background: #300; padding: 2px 6px; border-radius: 4px; border: 1px solid #500; }
        @keyframes scroll { 0% { transform: translateX(100vw); } 100% { transform: translateX(-100%); } }

        .container { max-width: 500px; margin: 20px auto; padding: 0 20px 80px 20px; }
        
        h1 { font-size: 2.5rem; margin-bottom: 5px; text-shadow: 2px 2px 8px #000; margin-top: 10px; }
        .subtitle { color: #ffb3b3; margin-bottom: 20px; font-size: 1.1rem; line-height: 1.6; }
        .culture-tag { display: inline-block; background: #500; color: #fff; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-bottom: 5px; }

        .tvl-card {
            background: linear-gradient(135deg, #300 0%, #000 100%);
            border: 2px solid var(--primary-gold);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        .tvl-card::before {
            content: "ğŸ’°";
            position: absolute;
            right: -10px;
            bottom: -20px;
            font-size: 100px;
            opacity: 0.1;
        }
        .tvl-label { font-size: 14px; color: #ffcccc; letter-spacing: 1px; }
        .tvl-value { font-size: 3.5rem; font-weight: bold; color: var(--primary-gold); margin: 5px 0; font-family: 'Roboto Mono', monospace; text-shadow: 0 0 10px rgba(255,215,0,0.5); }
        .tvl-sub { font-size: 12px; color: #aaa; }

        .stats-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
            margin-bottom: 25px;
        }
        .mini-stat {
            background: rgba(255, 215, 0, 0.1); border: 1px solid #886600;
            border-radius: 10px; padding: 10px;
        }
        .stat-val { font-size: 1.2rem; font-weight: bold; color: #fff; font-family: monospace; }
        .stat-lbl { font-size: 12px; color: #aaa; }

        .dashboard-card {
            background: var(--card-bg);
            border: 1px solid var(--primary-gold);
            border-radius: 15px;
            padding: 25px; margin-bottom: 25px;
            box-shadow: var(--neon-glow);
        }

        details.rules-accordion {
            background: rgba(0, 0, 0, 0.6);
            border: 1px dashed #886600;
            border-radius: 10px;
            margin-bottom: 25px;
            overflow: hidden;
            text-align: left;
        }
        details.rules-accordion summary {
            padding: 15px;
            cursor: pointer;
            font-weight: bold;
            color: var(--primary-gold);
            list-style: none; 
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        details.rules-accordion summary::after {
            content: "â–¼"; font-size: 12px; transition: transform 0.3s;
        }
        details.rules-accordion[open] summary::after {
            transform: rotate(180deg);
        }
        .rules-content {
            padding: 0 20px 20px 20px;
            border-top: 1px solid #443300;
            color: #ddd;
            font-size: 14px;
            line-height: 1.6;
        }
        .rule-item { margin-bottom: 12px; }
        .rule-title { color: #FFA500; font-weight: bold; display: block; }

        .wish-paper { background: #fffce0; border: 2px solid #b71c1c; padding: 20px 15px; color: #b71c1c; border-radius: 5px; margin-bottom: 20px; }
        .wish-input { width: 90%; border: none; border-bottom: 2px dashed #b71c1c; background: transparent; color: #b71c1c; font-size: 18px; padding: 8px; margin: 8px 0; text-align: center; outline: none; font-weight: bold; }
        
        .btn {
            background: linear-gradient(180deg, var(--primary-gold), #FFA500);
            color: #500000; border: none; padding: 15px 30px;
            font-size: 18px; font-weight: bold; border-radius: 50px;
            cursor: pointer; width: 100%; margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .btn:hover { filter: brightness(1.1); transform: translateY(-2px); }
        .btn:disabled { filter: grayscale(1); cursor: not-allowed; transform: none; }
        .btn-danger { background: linear-gradient(180deg, #ff5252, #b71c1c); color: white; }

        .hidden { display: none !important; }
        
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); z-index: 999;
            display: none; align-items: center; justify-content: center;
        }
        .error-modal {
            background: #2a0a0a; border: 2px solid #ff5252;
            padding: 20px; border-radius: 10px; width: 90%; max-width: 400px;
            text-align: left;
        }
        textarea.error-content { width: 100%; height: 100px; background: #000; color: #0f0; margin: 10px 0; resize: none; border: 1px solid #555;}
    </style>
</head>
<body>

    <div class="lang-bar">
        <button class="lang-btn active" onclick="setLang('tw')">ç¹é«”ä¸­æ–‡</button>
        <button class="lang-btn" onclick="setLang('en')">English</button>
        <button class="lang-btn" onclick="setLang('jp')">æ—¥æœ¬èª</button>
        <button class="lang-btn" onclick="setLang('kr')">í•œêµ­ì–´</button>
    </div>

    <div id="errorModal" class="modal-overlay">
        <div class="error-modal">
            <h3 style="color:#ff5252;margin-top:0;">âš ï¸ Error</h3>
            <textarea id="errorText" class="error-content" readonly></textarea>
            <button onclick="document.getElementById('errorModal').style.display='none'" style="padding:5px 10px;">Close</button>
        </div>
    </div>

    <div class="marquee-container">
        <div class="marquee-content" id="marqueeText">
            âœ¨ System Initializing... âœ¨
        </div>
    </div>

    <div class="container">
        <h1 data-i18n="title">ğŸ® éˆä¸Šå…‰æ˜ç‡ˆ</h1>
        
        <div class="subtitle">
            <span class="culture-tag" data-i18n="cultureTag">ğŸ‡¹ğŸ‡¼ å°ç£æ°‘ä¿—èˆ‡ç§‘æŠ€çµåˆ</span><br>
            <span data-i18n="subtitle">è‡ªå‹•è£œè²¡åº« â€¢ æ•¸ä½å…‰æ˜ç‡ˆ (Pancake V3 æ™ºèƒ½é–å€‰)</span>
        </div>

        <div class="tvl-card">
            <div class="tvl-label" data-i18n="tvlLabel">ğŸ”¥ ç´¯ç©é¦™æ²¹éŒ¢ (TVL)</div>
            <div class="tvl-value" id="totalBNB">0.00</div>
            <div class="tvl-sub">BNB</div>
        </div>

        <div class="stats-grid">
            <div class="mini-stat">
                <div class="stat-lbl" data-i18n="profitLabel">ğŸ’° ç´¯ç©å·²ç™¼åˆ©æ½¤</div>
                <div class="stat-val" id="totalProfit" style="color:#00FF00;">0.00</div>
            </div>
            <div class="mini-stat">
                <div class="stat-lbl" data-i18n="usersLabel">ğŸ‘¥ ç´¯ç©ä¿¡å¾’</div>
                <div class="stat-val" id="totalUsers">0</div>
            </div>
        </div>

        <details class="rules-accordion">
            <summary data-i18n="rulesBtn">ğŸ“œ æŸ¥çœ‹è¦å‰‡èˆ‡ã€Œè£œè²¡åº«ã€å¿ƒæ³• (é»æ“Šå±•é–‹)</summary>
            <div class="rules-content">
                <div class="rule-item">
                    <span class="rule-title" data-i18n="rule1Title">1. è²¡åº«ä¸Šé– (Locked for Wealth)</span>
                    <span data-i18n="rule1Desc">å°‡ BNB æŠ•å…¥æ™ºèƒ½åˆç´„ä¸¦é–å®š 365 å¤©ï¼Œè±¡å¾µã€ŒéŒ¢è²¡åªé€²ä¸å‡ºã€ï¼Œå¦‚åŒå°‡è³‡ç”¢å­˜å…¥å¤©åº«ï¼Œä¿®è£œè²¡é‹æ¼æ´ã€‚</span>
                </div>
                <div class="rule-item">
                    <span class="rule-title" data-i18n="rule2Title">2. æ•¸ä½å…‰æ˜ç‡ˆ (Digital Beacon)</span>
                    <span data-i18n="rule2Desc">æ‚¨çš„éŒ¢åŒ…åœ°å€èˆ‡é¡˜æœ›å°‡æ°¸ä¹…è¨˜éŒ„åœ¨å€å¡Šéˆä¸Šï¼Œå¦‚åŒå»Ÿå®‡çš„å…‰æ˜ç‡ˆï¼Œ24å°æ™‚ç…§äº®æ‚¨çš„è²¡é€”ã€‚</span>
                </div>
                <div class="rule-item">
                    <span class="rule-title" data-i18n="rule3Title">3. çœŸå¯¦æ”¶ç›Š (Real Yield)</span>
                    <span data-i18n="rule3Desc">è³‡é‡‘è‡ªå‹•å…Œæ›ç‚º slisBNB ç²å– PancakeSwap V3 æ”¶ç›Šã€‚æœŸæ»¿æ™‚ï¼Œæœ¬é‡‘åŠ åˆ©æ½¤å…¨æ•¸å¥‰é‚„ã€‚</span>
                </div>
                <div class="rule-item">
                    <span class="rule-title" style="color:#ff5252;" data-i18n="rule4Title">4. ç ´è²¡æ¶ˆç½ (Early Exit Penalty)</span>
                    <span data-i18n="rule4Desc">æœªæ»¿ä¸€å¹´ææ—©ç†„ç‡ˆï¼ˆé•ç´„ï¼‰ï¼Œå°‡æ‰£é™¤ 5% ä½œç‚ºé•ç´„é‡‘ï¼Œä¸¦ä¸ç™¼æ”¾åˆ©æ½¤ã€‚</span>
                </div>
            </div>
        </details>

        <div id="connectSection">
            <button id="connectBtn" class="btn" onclick="connectWallet()" data-i18n="connectBtn">ğŸ¦Š é€£çµéŒ¢åŒ… (Connect)</button>
            <p style="color:#aaa; font-size:13px; margin-top:10px;" data-i18n="networkHint">è«‹ä½¿ç”¨ BSC ä¸»ç¶² â€¢ 0.1 ~ 1.0 BNB</p>
        </div>

        <div id="loadingMsg" style="display:none; color:#FFA500; margin:20px 0;" data-i18n="loading">â³ è®€å–ä¸­...</div>

        <div id="lightLampSection" class="hidden">
            <div class="dashboard-card">
                <h3 style="margin-top:0; color:var(--primary-gold);" data-i18n="makeWishTitle">ğŸ™ å¡«å¯«ç¥ˆç¦ç–æ–‡</h3>
                <div style="font-size:13px; color:#ffcccc; background:#500; padding:8px; border-radius:5px; margin-bottom:10px;" data-i18n="limitHint">
                    âš ï¸ é™åˆ¶ï¼š0.1 ~ 1.0 BNB (è‡ªå‹•å…Œæ› slisBNB)
                </div>
                <div class="wish-paper">
                    <div style="margin-bottom:10px; font-size:14px; opacity:0.8;"><span data-i18n="userLabel">ä¿¡å¾’</span>ï¼š<span id="userAddrShort">...</span></div>
                    <input type="text" id="wish1" class="wish-input" placeholder="é¡˜æœ›ä¸€ (ä¾‹: è²¡æºå»£é€²)" maxlength="50">
                    <input type="text" id="wish2" class="wish-input" placeholder="é¡˜æœ›äºŒ (ä¾‹: èº«é«”å¥åº·)" maxlength="50">
                    <input type="text" id="wish3" class="wish-input" placeholder="é¡˜æœ›ä¸‰ (ä¾‹: æŠ•è³‡é †åˆ©)" maxlength="50">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="color:#aaa; font-size:14px;" data-i18n="amountLabel">é¦™æ²¹éŒ¢ (BNB)</label><br>
                    <input type="number" id="depositAmount" value="0.1" step="0.01" min="0.1" max="1.0" 
                        style="padding: 12px; margin-top:5px; border-radius: 8px; border:2px solid var(--primary-gold); background:#300; color:var(--primary-gold); text-align:center; width:150px; font-size:20px; font-weight:bold;">
                </div>
                <button id="lightBtn" class="btn" onclick="lightLamp()" data-i18n="lightBtn">âœ¨ èª å¿ƒé»ç‡ˆ (Light Up)</button>
            </div>
        </div>

        <div id="myLampSection" class="hidden">
            <div class="dashboard-card" style="box-shadow: 0 0 20px var(--primary-gold);">
                <h2 style="margin:0 0 15px 0; color:var(--primary-gold);" data-i18n="lampActiveTitle">ğŸ® æ‚¨çš„å…‰æ˜ç‡ˆå·²å®‰åº§</h2>
                <div style="text-align: left; background:rgba(0,0,0,0.3); padding:15px; border-radius:10px;">
                    <ul id="myWishesList" style="list-style:none; padding:0; color:#ffb3b3;"></ul>
                    <div style="border-top:1px dashed #555; margin-top:10px; padding-top:10px;">
                        <div><span data-i18n="principalLabel">ğŸ’° æŠ•å…¥æœ¬é‡‘</span>ï¼š<span id="myPrincipal" style="color:#fff;font-weight:bold;">0</span> BNB</div>
                        <div style="margin-top:5px;font-size:12px;color:#aaa;">
                            <span data-i18n="unlockLabel">ğŸ“… åœ“æ»¿æ—¥</span>ï¼š<span id="unlockDate" style="color:#fff;">---</span>
                        </div>
                    </div>
                </div>
                <div id="countdownSection" style="font-family:monospace; font-size:18px; color:#FFA500; background:rgba(0,0,0,0.5); padding:10px; margin:15px 0; border-radius:8px;">Loading...</div>
                
                <div style="margin-top:20px;">
                    <button id="redeemBtn" class="btn hidden" onclick="redeemLamp()" data-i18n="redeemBtn">ğŸ‰ åŠŸå¾·åœ“æ»¿ï¼Œé ˜å–æœ¬é‡‘+åˆ©æ½¤</button>
                    
                    <div id="earlyExitSection">
                        <div style="border:1px solid #ff5252; padding:15px; border-radius:10px; background:rgba(183,28,28,0.3);">
                            <h4 style="margin:0 0 10px 0; color:#ff5252;" data-i18n="emergencyTitle">âš ï¸ ææ—©ç†„ç‡ˆ (Emergency Exit)</h4>
                            <p style="color:#ff5252; font-size:13px;" data-i18n="emergencyDesc">è­¦å‘Šï¼šææ—©é›¢å ´è¦–ç‚ºé•ç´„ï¼Œåƒ…é€€é‚„æœ¬é‡‘ (æ‰£ 5% æ‰‹çºŒè²»)ï¼Œä¸ç™¼æ”¾åˆ©æ½¤ã€‚</p>
                            <button id="requestExitBtn" class="btn btn-danger" onclick="requestEarlyExit()" data-i18n="reqExitBtn">ç”³è«‹ç†„ç‡ˆ (é–‹å§‹ 7 å¤©å†·å»)</button>
                            
                            <div id="cooldownTimerDiv" class="hidden">
                                <p style="color:#FFA500;" data-i18n="cooldownMsg">â³ å†·å»ä¸­...</p>
                                <div id="cooldownTimer" style="font-size:16px; font-family:monospace; margin-bottom:10px;"></div>
                                <button id="executeExitBtn" class="btn btn-danger hidden" onclick="executeEarlyExit()" data-i18n="confirmExitBtn">ç¢ºèªç†„ç‡ˆ</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    const i18nData = {
        tw: {
            title: "ğŸ® éˆä¸Šå…‰æ˜ç‡ˆ",
            subtitle: "è‡ªå‹•è£œè²¡åº« â€¢ æ•¸ä½å…‰æ˜ç‡ˆ (Pancake V3 æ™ºèƒ½é–å€‰)",
            cultureTag: "ğŸ‡¹ğŸ‡¼ å°ç£æ°‘ä¿—èˆ‡ç§‘æŠ€çµåˆ",
            tvlLabel: "ğŸ”¥ ç´¯ç©é¦™æ²¹éŒ¢ (TVL)",
            profitLabel: "ğŸ’° ç´¯ç©å·²ç™¼åˆ©æ½¤",
            usersLabel: "ğŸ‘¥ ç´¯ç©ä¿¡å¾’",
            rulesBtn: "ğŸ“œ æŸ¥çœ‹è¦å‰‡èˆ‡ã€Œè£œè²¡åº«ã€å¿ƒæ³• (é»æ“Šå±•é–‹)",
            rule1Title: "1. è²¡åº«ä¸Šé– (Locked for Wealth)",
            rule1Desc: "å°‡ BNB æŠ•å…¥æ™ºèƒ½åˆç´„ä¸¦é–å®š 365 å¤©ï¼Œè±¡å¾µã€ŒéŒ¢è²¡åªé€²ä¸å‡ºã€ï¼Œå¦‚åŒå°‡è³‡ç”¢å­˜å…¥å¤©åº«ï¼Œä¿®è£œè²¡é‹æ¼æ´ã€‚",
            rule2Title: "2. æ•¸ä½å…‰æ˜ç‡ˆ (Digital Beacon)",
            rule2Desc: "æ‚¨çš„éŒ¢åŒ…åœ°å€èˆ‡é¡˜æœ›å°‡æ°¸ä¹…è¨˜éŒ„åœ¨å€å¡Šéˆä¸Šï¼Œå¦‚åŒå»Ÿå®‡çš„å…‰æ˜ç‡ˆï¼Œ24å°æ™‚ç…§äº®æ‚¨çš„è²¡é€”ã€‚",
            rule3Title: "3. çœŸå¯¦æ”¶ç›Š (Real Yield)",
            rule3Desc: "è³‡é‡‘è‡ªå‹•å…Œæ›ç‚º slisBNB ç²å– PancakeSwap V3 æ”¶ç›Šã€‚æœŸæ»¿æ™‚ï¼Œæœ¬é‡‘åŠ åˆ©æ½¤å…¨æ•¸å¥‰é‚„ã€‚",
            rule4Title: "4. ç ´è²¡æ¶ˆç½ (Early Exit Penalty)",
            rule4Desc: "æœªæ»¿ä¸€å¹´ææ—©ç†„ç‡ˆï¼ˆé•ç´„ï¼‰ï¼Œå°‡æ‰£é™¤ 5% ä½œç‚ºé•ç´„é‡‘ï¼Œä¸¦ä¸ç™¼æ”¾åˆ©æ½¤ã€‚",
            connectBtn: "ğŸ¦Š é€£çµéŒ¢åŒ… (Connect)",
            networkHint: "è«‹ä½¿ç”¨ BSC ä¸»ç¶² â€¢ 0.1 ~ 1.0 BNB",
            loading: "â³ è®€å–ä¸­...",
            makeWishTitle: "ğŸ™ å¡«å¯«ç¥ˆç¦ç–æ–‡",
            limitHint: "âš ï¸ é™åˆ¶ï¼š0.1 ~ 1.0 BNB (è‡ªå‹•å…Œæ› slisBNB)",
            userLabel: "ä¿¡å¾’",
            amountLabel: "é¦™æ²¹éŒ¢ (BNB)",
            lightBtn: "âœ¨ èª å¿ƒé»ç‡ˆ (Light Up)",
            lampActiveTitle: "ğŸ® æ‚¨çš„å…‰æ˜ç‡ˆå·²å®‰åº§",
            principalLabel: "ğŸ’° æŠ•å…¥æœ¬é‡‘",
            unlockLabel: "ğŸ“… åœ“æ»¿æ—¥",
            redeemBtn: "ğŸ‰ åŠŸå¾·åœ“æ»¿ï¼Œé ˜å–æœ¬é‡‘+åˆ©æ½¤",
            emergencyTitle: "âš ï¸ ææ—©ç†„ç‡ˆ (Emergency Exit)",
            emergencyDesc: "è­¦å‘Šï¼šææ—©é›¢å ´è¦–ç‚ºé•ç´„ï¼Œåƒ…é€€é‚„æœ¬é‡‘ (æ‰£ 5% æ‰‹çºŒè²»)ï¼Œä¸ç™¼æ”¾åˆ©æ½¤ã€‚",
            reqExitBtn: "ç”³è«‹ç†„ç‡ˆ (é–‹å§‹ 7 å¤©å†·å»)",
            cooldownMsg: "â³ å†·å»ä¸­...",
            confirmExitBtn: "ç¢ºèªç†„ç‡ˆ"
        },
        en: {
            title: "ğŸ® On-chain Beacon",
            subtitle: "Replenish Wealth Treasury â€¢ Digital Beacon Light (V3 Lock)",
            cultureTag: "ğŸ‡¹ğŸ‡¼ Taiwanese Tradition x DeFi",
            tvlLabel: "ğŸ”¥ Total Value Locked (TVL)",
            profitLabel: "ğŸ’° Yield Paid",
            usersLabel: "ğŸ‘¥ Believers",
            rulesBtn: "ğŸ“œ Rules & The Law of Attraction (Click)",
            rule1Title: "1. Lock for Wealth",
            rule1Desc: "Locking BNB for 365 days symbolizes securing your 'Wealth Treasury' to prevent financial leakage.",
            rule2Title: "2. Digital Beacon",
            rule2Desc: "Your address and wishes are immutable on the blockchain, shining like a beacon light 24/7.",
            rule3Title: "3. Real Yield",
            rule3Desc: "Funds are swapped to slisBNB for PancakeSwap V3 yield. Principal + Profit returned upon maturity.",
            rule4Title: "4. Penalty (Breaking Vow)",
            rule4Desc: "Early exit incurs a 5% fee on principal and forfeits all accumulated profits.",
            connectBtn: "ğŸ¦Š Connect Wallet",
            networkHint: "BSC Mainnet â€¢ 0.1 ~ 1.0 BNB",
            loading: "â³ Loading...",
            makeWishTitle: "ğŸ™ Make Your Wish",
            limitHint: "âš ï¸ Limit: 0.1 ~ 1.0 BNB (Swapped to slisBNB)",
            userLabel: "User",
            amountLabel: "Donation (BNB)",
            lightBtn: "âœ¨ Light Up Lamp",
            lampActiveTitle: "ğŸ® Lamp Activated",
            principalLabel: "ğŸ’° Principal",
            unlockLabel: "ğŸ“… Unlock Date",
            redeemBtn: "ğŸ‰ Maturity Reached! Claim All",
            emergencyTitle: "âš ï¸ Emergency Exit",
            emergencyDesc: "Warning: Early exit returns Principal minus 5% Fee. No profit.",
            reqExitBtn: "Request Exit (7d Cooldown)",
            cooldownMsg: "â³ Cooldown Active...",
            confirmExitBtn: "Confirm Exit"
        },
        jp: {
            title: "ğŸ® ã‚ªãƒ³ãƒã‚§ãƒ¼ãƒ³å…‰æ˜ç¯",
            subtitle: "è²¡åº«è£œå¡« â€¢ ãƒ‡ã‚¸ã‚¿ãƒ«å…‰æ˜ç¯ (Pancake V3 ãƒ­ãƒƒã‚¯)",
            cultureTag: "ğŸ‡¹ğŸ‡¼ å°æ¹¾ã®ä¼çµ± x ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³",
            tvlLabel: "ğŸ”¥ ç·ãƒ­ãƒƒã‚¯é¡ (TVL)",
            profitLabel: "ğŸ’° åˆ†é…æ¸ˆã¿åˆ©ç›Š",
            usersLabel: "ğŸ‘¥ ä¿¡è€…æ•°",
            rulesBtn: "ğŸ“œ ãƒ«ãƒ¼ãƒ«ã¨è²¡é‹ã®æ³•å‰‡ (ã‚¯ãƒªãƒƒã‚¯ã—ã¦å±•é–‹)",
            rule1Title: "1. è²¡åº«ã®ãƒ­ãƒƒã‚¯ (Lock)",
            rule1Desc: "BNBã‚’365æ—¥é–“ãƒ­ãƒƒã‚¯ã™ã‚‹ã“ã¨ã¯ã€è³‡ç”£ã‚’å¤©ã®é‡‘åº«ã«é ã‘ã€è²¡é‹ã‚’å®‰å®šã•ã›ã‚‹ã“ã¨ã‚’è±¡å¾´ã—ã¦ã„ã¾ã™ã€‚",
            rule2Title: "2. ãƒ‡ã‚¸ã‚¿ãƒ«å…‰æ˜ç¯",
            rule2Desc: "ã‚ãªãŸã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨é¡˜ã„ã¯ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã«æ°¸é ã«åˆ»ã¾ã‚Œã€24æ™‚é–“ã‚ãªãŸã®é“ã‚’ç…§ã‚‰ã—ã¾ã™ã€‚",
            rule3Title: "3. ãƒªã‚¢ãƒ«ã‚¤ãƒ¼ãƒ«ãƒ‰",
            rule3Desc: "è³‡é‡‘ã¯slisBNBã«äº¤æ›ã•ã‚Œé‹ç”¨ã•ã‚Œã¾ã™ã€‚æº€æœŸæ™‚ã«å…ƒæœ¬ã¨åˆ©ç›ŠãŒè¿”é‚„ã•ã‚Œã¾ã™ã€‚",
            rule4Title: "4. æ—©æœŸè§£ç´„ãƒšãƒŠãƒ«ãƒ†ã‚£",
            rule4Desc: "1å¹´æœªæº€ã®è§£ç´„ã¯5%ã®æ‰‹æ•°æ–™ãŒç™ºç”Ÿã—ã€åˆ©ç›Šã¯æ²¡åã•ã‚Œã¾ã™ã€‚",
            connectBtn: "ğŸ¦Š ã‚¦ã‚©ãƒ¬ãƒƒãƒˆæ¥ç¶š",
            networkHint: "BSCãƒ¡ã‚¤ãƒ³ãƒãƒƒãƒˆ â€¢ 0.1 ~ 1.0 BNB",
            loading: "â³ èª­ã¿è¾¼ã¿ä¸­...",
            makeWishTitle: "ğŸ™ é¡˜ã„äº‹ã‚’æ›¸ã",
            limitHint: "âš ï¸ åˆ¶é™ï¼š0.1 ~ 1.0 BNB",
            userLabel: "ä¿¡è€…",
            amountLabel: "å¥‰ç´é¡ (BNB)",
            lightBtn: "âœ¨ ç‚¹ç¯ã™ã‚‹",
            lampActiveTitle: "ğŸ® ç‚¹ç¯ä¸­",
            principalLabel: "ğŸ’° å…ƒæœ¬",
            unlockLabel: "ğŸ“… æº€æœŸæ—¥",
            redeemBtn: "ğŸ‰ æº€æœŸï¼å…ƒæœ¬ã¨åˆ©ç›Šã‚’å—ã‘å–ã‚‹",
            emergencyTitle: "âš ï¸ ç·Šæ€¥è„±å‡º",
            emergencyDesc: "è­¦å‘Šï¼šæ—©æœŸè„±å‡ºã¯å…ƒæœ¬ã®5%ãŒæ‰‹æ•°æ–™ã¨ã—ã¦å¼•ã‹ã‚Œã€åˆ©ç›Šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚",
            reqExitBtn: "è„±å‡ºç”³è«‹ (7æ—¥é–“ã®å†·å´æœŸé–“)",
            cooldownMsg: "â³ å†·å´ä¸­...",
            confirmExitBtn: "è„±å‡ºç¢ºå®š"
        },
        kr: {
            title: "ğŸ® ì˜¨ì²´ì¸ ê´‘ëª…ë“±",
            subtitle: "ì¬ë¬¼ìš´ ë³´ê°• â€¢ ë””ì§€í„¸ ê´‘ëª…ë“± (Pancake V3 ë½ì—…)",
            cultureTag: "ğŸ‡¹ğŸ‡¼ ëŒ€ë§Œ ì „í†µ x ë¸”ë¡ì²´ì¸",
            tvlLabel: "ğŸ”¥ ì´ ì˜ˆì¹˜ê¸ˆ (TVL)",
            profitLabel: "ğŸ’° ë¶„ë°°ëœ ìˆ˜ìµ",
            usersLabel: "ğŸ‘¥ ì°¸ì—¬ì ìˆ˜",
            rulesBtn: "ğŸ“œ ê·œì¹™ ë° ì¬ë¬¼ìš´ ë²•ì¹™ (í´ë¦­)",
            rule1Title: "1. ì¬ë¬¼ ì°½ê³  ì ê¸ˆ",
            rule1Desc: "365ì¼ ë™ì•ˆ BNBë¥¼ ì ê·¸ëŠ” ê²ƒì€ ì¬ë¬¼ìš´ì´ ìƒˆë‚˜ê°€ì§€ ì•Šë„ë¡ í•˜ëŠ˜ì˜ ì°½ê³ ì— ë³´ê´€í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.",
            rule2Title: "2. ë””ì§€í„¸ ê´‘ëª…ë“±",
            rule2Desc: "ë‹¹ì‹ ì˜ ì£¼ì†Œì™€ ì†Œì›ì€ ë¸”ë¡ì²´ì¸ì— ì˜êµ¬íˆ ê¸°ë¡ë˜ì–´ 24ì‹œê°„ ë‹¹ì‹ ì˜ ì•ê¸¸ì„ ë¹„ì¶¥ë‹ˆë‹¤.",
            rule3Title: "3. ì‹¤ì§ˆ ìˆ˜ìµ (Real Yield)",
            rule3Desc: "ìê¸ˆì€ slisBNBë¡œ êµí™˜ë˜ì–´ ìš´ìš©ë©ë‹ˆë‹¤. ë§Œê¸° ì‹œ ì›ê¸ˆê³¼ ìˆ˜ìµì´ ë°˜í™˜ë©ë‹ˆë‹¤.",
            rule4Title: "4. ì¡°ê¸° ì¢…ë£Œ ìœ„ì•½ê¸ˆ",
            rule4Desc: "1ë…„ ë¯¸ë§Œ ì¡°ê¸° ì¢…ë£Œ ì‹œ ì›ê¸ˆì˜ 5%ê°€ ì°¨ê°ë˜ë©°, ìˆ˜ìµì€ ì§€ê¸‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
            connectBtn: "ğŸ¦Š ì§€ê°‘ ì—°ê²°",
            networkHint: "BSC ë©”ì¸ë„· â€¢ 0.1 ~ 1.0 BNB",
            loading: "â³ ë¡œë”© ì¤‘...",
            makeWishTitle: "ğŸ™ ì†Œì› ì ê¸°",
            limitHint: "âš ï¸ í•œë„: 0.1 ~ 1.0 BNB",
            userLabel: "ì‹ ë„",
            amountLabel: "ë´‰ë‚©ì•¡ (BNB)",
            lightBtn: "âœ¨ ì ë“±í•˜ê¸°",
            lampActiveTitle: "ğŸ® ë“±ë¶ˆ ì•ˆì¹˜ ì™„ë£Œ",
            principalLabel: "ğŸ’° ì›ê¸ˆ",
            unlockLabel: "ğŸ“… ë§Œê¸°ì¼",
            redeemBtn: "ğŸ‰ ë§Œê¸° ë„ë‹¬! ì›ê¸ˆ+ìˆ˜ìµ ìˆ˜ë ¹",
            emergencyTitle: "âš ï¸ ì¡°ê¸° ì¢…ë£Œ",
            emergencyDesc: "ê²½ê³ : ì¡°ê¸° ì¢…ë£Œ ì‹œ ì›ê¸ˆì˜ 5% ìˆ˜ìˆ˜ë£Œê°€ ë°œìƒí•˜ë©° ìˆ˜ìµì€ ì—†ìŠµë‹ˆë‹¤.",
            reqExitBtn: "ì¢…ë£Œ ì‹ ì²­ (7ì¼ ëŒ€ê¸°)",
            cooldownMsg: "â³ ëŒ€ê¸° ì¤‘...",
            confirmExitBtn: "ì¢…ë£Œ í™•ì •"
        }
    };

    function setLang(lang) {
        document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        const data = i18nData[lang];
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if(data[key]) el.innerText = data[key];
        });

        if(lang === 'tw') {
            document.getElementById('wish1').placeholder = "é¡˜æœ›ä¸€ (ä¾‹: è²¡æºå»£é€²)";
            document.getElementById('wish2').placeholder = "é¡˜æœ›äºŒ (ä¾‹: èº«é«”å¥åº·)";
            document.getElementById('wish3').placeholder = "é¡˜æœ›ä¸‰ (ä¾‹: æŠ•è³‡é †åˆ©)";
        } else if(lang === 'en') {
            document.getElementById('wish1').placeholder = "Wish 1 (e.g. Wealth)";
            document.getElementById('wish2').placeholder = "Wish 2 (e.g. Health)";
            document.getElementById('wish3').placeholder = "Wish 3 (e.g. Success)";
        } else {
            document.getElementById('wish1').placeholder = "Wish 1";
            document.getElementById('wish2').placeholder = "Wish 2";
            document.getElementById('wish3').placeholder = "Wish 3";
        }
    }

    const CONTRACT_ADDRESS = "0x0fE20821301E6a8319015a1D26D7a545630235D9"; 

    const ABI = [
        "function lightLamp(string[3] _wishes) external payable",
        "function redeemLamp() external",
        "function requestEarlyExit() external",
        "function executeEarlyExit() external",
        "function getLampData(address _user) view returns (tuple(string[3] wishes, uint256 principal, uint256 shares, uint256 unlockTime, uint256 cooldownEndTime, bool exists))",
        "function getBatchLamps(uint256 count) view returns (tuple(address user, string[3] wishes)[])",
        "function getGlobalStats() view returns (uint256, uint256, uint256)"
    ];

    let provider, signer, contract;
    let userAddress;
    let countdownInterval;
    const RPC_URLS = ["https://bsc-dataseed1.binance.org/", "https://rpc.ankr.com/bsc"];

    function showError(err) {
        const modal = document.getElementById("errorModal");
        let msg = typeof err === 'object' ? JSON.stringify(err, null, 2) : err;
        document.getElementById("errorText").value = msg;
        modal.style.display = "flex";
    }

    window.onload = function() {
        initData();
    };

    async function initData() {
        const marqueeDiv = document.getElementById("marqueeText");
        for (let url of RPC_URLS) {
            try {
                const readProvider = new ethers.providers.JsonRpcProvider(url);
                const readContract = new ethers.Contract(CONTRACT_ADDRESS, ABI, readProvider);
                
                const code = await readProvider.getCode(CONTRACT_ADDRESS);
                if (code === "0x") throw new Error("Contract Error");

                const [lamps, stats] = await Promise.all([
                    readContract.getBatchLamps(150),
                    readContract.getGlobalStats()
                ]);

                document.getElementById("totalBNB").innerText = parseFloat(ethers.utils.formatEther(stats[0])).toFixed(2);
                document.getElementById("totalUsers").innerText = stats[1].toString();
                document.getElementById("totalProfit").innerText = parseFloat(ethers.utils.formatEther(stats[2])).toFixed(4) + " BNB";

                if (lamps.length > 0) {
                    let html = "";
                    let allWishes = [];
                    for (let i = 0; i < 3; i++) {
                        lamps.forEach(lamp => {
                            const addr = lamp.user.substring(0,6) + ".." + lamp.user.substring(38);
                            const wish = lamp.wishes[i];
                            if (wish && wish.trim() !== "") allWishes.push({ addr, wish });
                        });
                    }
                    allWishes.forEach(item => { html += `<span class="marquee-item"><span class="marquee-addr">${item.addr}</span> ${item.wish}</span>`; });
                    marqueeDiv.innerHTML = html + html;
                } else {
                    marqueeDiv.innerHTML = "âœ¨ 2026 éˆä¸Šå…‰æ˜ç‡ˆè™›ä½ä»¥å¾…ï¼Œç¾åœ¨é»ç‡ˆæ‚¨å°±æ˜¯ç¬¬ä¸€ä½ï¼ âœ¨";
                }
                return;
            } catch (e) { continue; }
        }
    }

    async function connectWallet() {
        if (typeof window.ethereum === 'undefined') { alert("Please install MetaMask"); return; }
        try {
            provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            
            const network = await provider.getNetwork();
            if (network.chainId !== 56) {
                try {
                    await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x38' }]});
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                } catch(e) { throw new Error("Switch to BSC Mainnet"); }
            }

            signer = provider.getSigner();
            userAddress = await signer.getAddress();
            
            document.getElementById("connectSection").classList.add("hidden");
            document.getElementById("loadingMsg").style.display = "block";
            document.getElementById("userAddrShort").innerText = userAddress.substring(0,6) + "..." + userAddress.substring(38);
            
            contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
            await checkLampStatus();

        } catch (e) { showError(e); }
    }

    async function checkLampStatus() {
        try {
            const lamp = await contract.getLampData(userAddress);
            document.getElementById("loadingMsg").style.display = "none";

            if (lamp.exists && lamp.shares.gt(0)) {
                document.getElementById("myLampSection").classList.remove("hidden");
                renderMyLamp(lamp);
            } else {
                document.getElementById("lightLampSection").classList.remove("hidden");
            }
        } catch (e) { showError(e); }
    }

    function renderMyLamp(lamp) {
        const wishList = document.getElementById("myWishesList");
        wishList.innerHTML = "";
        lamp[0].forEach(w => { if(w) wishList.innerHTML += `<li>âœ¨ ${w}</li>`; });
        
        document.getElementById("myPrincipal").innerText = parseFloat(ethers.utils.formatEther(lamp[1])).toFixed(4);
        const unlockTime = lamp[3].toNumber();
        document.getElementById("unlockDate").innerText = new Date(unlockTime*1000).toLocaleString();

        if(countdownInterval) clearInterval(countdownInterval);
        const now = Math.floor(Date.now() / 1000);

        if (now >= unlockTime) {
            document.getElementById("countdownSection").innerText = "âœ¨ åŠŸå¾·åœ“æ»¿ï¼";
            document.getElementById("redeemBtn").classList.remove("hidden");
            document.getElementById("earlyExitSection").classList.add("hidden");
        } else {
            const cooldownEnd = lamp[4].toNumber();
            if (cooldownEnd > 0) {
                document.getElementById("requestExitBtn").classList.add("hidden");
                document.getElementById("cooldownTimerDiv").classList.remove("hidden");
                if (now >= cooldownEnd) {
                    document.getElementById("cooldownTimer").innerText = "Ready to Exit";
                    document.getElementById("executeExitBtn").classList.remove("hidden");
                } else {
                    startCountdown(cooldownEnd, "cooldownTimer", "Ready", () => checkLampStatus());
                }
            } else {
                startCountdown(unlockTime, "countdownSection", "Done", () => checkLampStatus());
            }
        }
    }

    async function lightLamp() {
        const w1 = document.getElementById("wish1").value;
        const w2 = document.getElementById("wish2").value;
        const w3 = document.getElementById("wish3").value;
        const amt = document.getElementById("depositAmount").value;
        
        if ((w1+w2+w3).match(/\d{9,}/)) { if(!confirm("Contains long numbers. Proceed?")) return; }

        try {
            const gasLimit = await contract.estimateGas.lightLamp([w1, w2, w3], { value: ethers.utils.parseEther(amt) });
            const tx = await contract.lightLamp([w1, w2, w3], { 
                value: ethers.utils.parseEther(amt),
                gasLimit: gasLimit.mul(120).div(100)
            });
            alert("Transaction Sent...");
            await tx.wait();
            alert("Success!");
            location.reload(); 
        } catch(e) { showError(e); }
    }

    async function redeemLamp() { try { const tx = await contract.redeemLamp(); await tx.wait(); alert("Success!"); location.reload(); } catch(e){showError(e);} }
    async function requestEarlyExit() { if(!confirm("Sure? 5% Fee applies.")) return; try { const tx = await contract.requestEarlyExit(); await tx.wait(); alert("Cooldown Started"); location.reload(); } catch(e){showError(e);} }
    async function executeEarlyExit() { try { const tx = await contract.executeEarlyExit(); await tx.wait(); alert("Exited"); location.reload(); } catch(e){showError(e);} }

    function startCountdown(target, id, msg, cb) {
        const el = document.getElementById(id);
        countdownInterval = setInterval(() => {
            const now = Math.floor(Date.now()/1000);
            const diff = target - now;
            if(diff <= 0) { clearInterval(countdownInterval); el.innerText = msg; if(cb) cb(); }
            else {
                const d = Math.floor(diff/86400);
                const h = Math.floor((diff%86400)/3600);
                const m = Math.floor((diff%3600)/60);
                const s = diff%60;
                el.innerText = `${d}d ${h}h ${m}m ${s}s`;
            }
        }, 1000);
    }
</script>
</body>
</html>


